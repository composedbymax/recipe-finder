<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipe App</title>
<style>
    body{font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;margin: 0;padding: 0;background: #f9f9f9;color: #333;}
    header{background: linear-gradient(90deg, #4CAF50, #45A049);color: #fff;text-align: center;padding: 1.5rem;box-shadow: 0 3px 6px rgba(0,0,0,0.1);}
    header h1{margin: 0;font-size: 2rem;letter-spacing: 1px;}
    main{max-width: 1000px;margin: 2rem auto;padding: 0 1rem;}
    section{margin-bottom: 3rem;background: #fff;padding: 1.5rem;border-radius: 12px;box-shadow: 0 2px 8px rgba(0,0,0,0.05);}
    input{padding: 0.6rem 0.8rem;border-radius: 6px;border: 1px solid #ccc;width: 200px;font-size: 1rem;}
    button{padding: 0.6rem 1rem;border-radius: 6px;border: none;background-color: #4CAF50;color: white;font-size: 1rem;cursor: pointer;transition: all 0.2s ease;}
    button:hover{background-color: #45a049;transform: translateY(-1px);}
    .recipe{border: none;padding: 1.5rem;margin: 1rem 0;border-radius: 12px;box-shadow: 0 2px 12px rgba(0,0,0,0.08);background-color: #fff;transition: transform 0.2s ease, box-shadow 0.2s ease;}
    .recipe:hover{transform: translateY(-3px);box-shadow: 0 4px 16px rgba(0,0,0,0.12);}
    .recipe img{max-width: 100%;border-radius: 8px;margin-bottom: 1rem;}
    .recipe-video{width: 100%;height: 315px;margin-top: 1rem;border-radius: 8px;}
    ul, ol{padding-left: 1.5rem;margin-bottom: 1rem;}
    .recipe-title{margin-top: 0;font-size: 1.5rem;color: #333;}
    .recipe .saveBtn, .recipe .editBtn{margin-top: 0.5rem;margin-right: 0.5rem;}
    .recipe .saveBtn{background-color: #2196F3;}
    .recipe .saveBtn:hover{background-color: #1976D2;}
    .recipe .editBtn{background-color: #FF9800;}
    .recipe .editBtn:hover{background-color: #FB8C00;}
    .pagination{text-align: center;margin-top: 2rem;}
    .pagination button{background-color: #6B73FF;font-size: 1.1rem;padding: 0.8rem 1.5rem;border-radius: 50px;display: inline-flex;align-items: center;gap: 0.5rem;}
    .pagination button:hover{background-color: #5A63E8;}
    .pagination button:disabled{background-color: #ccc;cursor: not-allowed;transform: none;}
    .pagination button:disabled:hover{background-color: #ccc;transform: none;}
    .arrow{font-size: 1.2rem;}
    @media (max-width: 600px){input{width: 100%;margin-bottom: 0.5rem;}
    button{width: 100%;margin-bottom: 0.5rem;}}
</style>
</head>
<body>
    <header><h1>Recipe App</h1></header>
    <main>
        <section class="search">
            <input id="ingredientInput" placeholder="Enter ingredient(s)">
            <button id="searchBtn">Search</button>
            <button id="randomBtn">Random Recipe</button>
        </section>
        <section class="recipes">
            <h2>Results</h2>
            <div id="results"></div>
            <div class="pagination">
                <button id="loadMoreBtn" style="display: none;">
                    Load More <span class="arrow">â†’</span>
                </button>
            </div>
        </section>
        <section class="saved">
            <h2>Saved Recipes</h2>
            <div id="savedRecipes"></div>
        </section>
        <template id="recipeTemplate">
            <div class="recipe">
                <h3 class="recipe-title"></h3>
                <img class="recipe-img" src="" alt="Recipe Image">
                <iframe class="recipe-video" frameborder="0" allowfullscreen></iframe>
                <h4>Ingredients:</h4>
                <ul class="recipe-ingredients"></ul>
                <h4>Instructions:</h4>
                <ol class="recipe-instructions"></ol>
                <button class="saveBtn">Save</button>
                <button class="editBtn">Edit</button>
            </div>
        </template>
    </main>
    <script>
        let db;
        let allRecipes = [];
        let displayedCount = 0;
        const RECIPES_PER_PAGE = 15;
        const request = indexedDB.open('RecipeDB', 1);
        request.onupgradeneeded = e => {
            db = e.target.result;
            const store = db.createObjectStore('recipes', { keyPath: 'idMeal' });
            store.createIndex('name', 'strMeal', { unique:false });
        };
        request.onsuccess = e => { db = e.target.result; displaySavedRecipes(); };
        request.onerror = e => console.error('IndexedDB error', e);
        function getEmbedUrl(youtubeUrl) {
            if (!youtubeUrl) return null;
            try {
                const url = new URL(youtubeUrl);
                const videoId = url.searchParams.get('v');
                return videoId ? `https://www.youtube.com/embed/${videoId}` : null;
            } catch {
                return null;
            }
        }
        async function fetchRecipes(query) {
            const endpoint = !query || query==='random'
                ? 'https://www.themealdb.com/api/json/v1/1/random.php'
                : `https://www.themealdb.com/api/json/v1/1/search.php?s=${encodeURIComponent(query)}`;
            const data = await (await fetch(endpoint)).json();
            allRecipes = data.meals || [];
            displayedCount = 0;
            document.getElementById('results').innerHTML = '';
            displayNextBatch();
        }
        function displayNextBatch() {
            const recipesToShow = allRecipes.slice(displayedCount, displayedCount + RECIPES_PER_PAGE);
            displayRecipes(recipesToShow, true);
            displayedCount += recipesToShow.length;
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (displayedCount < allRecipes.length) {
                loadMoreBtn.style.display = 'block';
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }
        function parseInstructions(raw) {
            const steps = [];
            if (!raw) return steps;
            const lines = raw.split(/\r?\n|(?<=\.)\s*(?=\d+\.)/);
            lines.forEach(line => {
                let trimmed = line.trim();
                if (!trimmed) return;
                trimmed = trimmed.replace(/^(STEP\s*\d+|\d+\.)\s*/i, '').trim();
                if (trimmed) steps.push(trimmed);
            });
            return steps;
        }
        function displayRecipes(recipes, append = false) {
            const results = document.getElementById('results');
            if (!append) results.innerHTML = '';
            const template = document.getElementById('recipeTemplate');
            recipes.forEach(recipe => {
                const clone = template.content.cloneNode(true);
                clone.querySelector('.recipe-title').textContent = recipe.strMeal;
                clone.querySelector('.recipe-img').src = recipe.strMealThumb;
                const ingredientsList = clone.querySelector('.recipe-ingredients');
                for(let i=1;i<=20;i++){
                    const ingredient = recipe['strIngredient'+i];
                    const measure = recipe['strMeasure'+i];
                    if(ingredient && ingredient.trim()!==''){
                        const li = document.createElement('li');
                        li.textContent = `${measure || ''} ${ingredient}`.trim();
                        ingredientsList.appendChild(li);
                    }
                }
                const instructionsList = clone.querySelector('.recipe-instructions');
                parseInstructions(recipe.strInstructions).forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    instructionsList.appendChild(li);
                });
                const videoFrame = clone.querySelector('.recipe-video');
                const embedUrl = getEmbedUrl(recipe.strYoutube);
                if (embedUrl) {
                    videoFrame.src = embedUrl;
                } else {
                    videoFrame.style.display = 'none';
                }
                clone.querySelector('.saveBtn').onclick = () => saveRecipe(recipe);
                clone.querySelector('.editBtn').onclick = () => editRecipe(recipe);
                results.appendChild(clone);
            });
        }
        function saveRecipe(recipe) {
            const tx = db.transaction('recipes','readwrite');
            tx.objectStore('recipes').put(recipe);
            tx.oncomplete = displaySavedRecipes;
        }
        function displaySavedRecipes() {
            const tx = db.transaction('recipes','readonly');
            const store = tx.objectStore('recipes');
            const saved = document.getElementById('savedRecipes');
            saved.innerHTML = '';
            store.openCursor().onsuccess = e => {
                const cursor = e.target.result;
                if(!cursor) return;
                const r = cursor.value;
                const div = document.createElement('div');
                div.className='recipe';
                const ingredients = [];
                for(let i=1;i<=20;i++){
                    const ing = r['strIngredient'+i], measure = r['strMeasure'+i];
                    if(ing && ing.trim()!=='') ingredients.push(`${measure || ''} ${ing}`.trim());
                }
                const instructionsSteps = parseInstructions(r.strInstructions);
                const embedUrl = getEmbedUrl(r.strYoutube);
                const videoHTML = embedUrl ? `<iframe class="recipe-video" src="${embedUrl}" frameborder="0" allowfullscreen></iframe>` : '';
                div.innerHTML = `<h3>${r.strMeal}</h3>
                    <img src="${r.strMealThumb}" alt="Recipe Image">
                    ${videoHTML}
                    <h4>Ingredients:</h4>
                    <ul>${ingredients.map(i=>`<li>${i}</li>`).join('')}</ul>
                    <h4>Instructions:</h4>
                    <ol>${instructionsSteps.map(i=>`<li>${i}</li>`).join('')}</ol>
                    <button class="editBtn">Edit</button>`;
                div.querySelector('.editBtn').onclick = () => editRecipe(r);
                saved.appendChild(div);
                cursor.continue();
            };
        }
        function editRecipe(recipe) {
            const newInstructions = prompt('Edit instructions:', recipe.strInstructions);
            if(newInstructions !== null){
                recipe.strInstructions = newInstructions;
                saveRecipe(recipe);
            }
        }
        document.getElementById('searchBtn').onclick = () => fetchRecipes(document.getElementById('ingredientInput').value.trim());
        document.getElementById('randomBtn').onclick = () => fetchRecipes('random');
        document.getElementById('loadMoreBtn').onclick = displayNextBatch;
    </script>
</body>
</html>